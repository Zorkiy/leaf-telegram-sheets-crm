# üçÉ Telegram Bot to Google Sheets Integration

![PHP](https://img.shields.io/badge/PHP-8.2-777BB4?style=for-the-badge&logo=php)
![Leaf PHP](https://img.shields.io/badge/Leaf_PHP-v4-00BFA5?style=for-the-badge&logo=leaf)
![Docker](https://img.shields.io/badge/Docker-Ready-2496ED?style=for-the-badge&logo=docker)
![License](https://img.shields.io/badge/License-MIT-green?style=for-the-badge)

## ‚ö°Ô∏è –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î (Live Demo)

![Image](https://github.com/user-attachments/assets/e444771d-1746-4c65-aaea-8a91d5455673)

*(–ü—Ä–∏–∫–ª–∞–¥: –º–∏—Ç—Ç—î–≤–µ –ø–æ–ø–∞–¥–∞–Ω–Ω—è –∑–∞—è–≤–∫–∏ –∑ —á–∞—Ç—É –≤ —Ç–∞–±–ª–∏—Ü—é)*

---

**–ü—Ä–æ—Å—Ç–∏–π, –Ω–∞–¥—ñ–π–Ω–∏–π —Ç–∞ –±–µ–∑–ø–µ—á–Ω–∏–π –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–±–æ—Ä—É –∑–∞—è–≤–æ–∫, –≤—ñ–¥–≥—É–∫—ñ–≤ –∞–±–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑ Telegram –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ —É Google –¢–∞–±–ª–∏—Ü—ñ.**

–¶–µ–π –ø—Ä–æ—î–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –ø—ñ–¥—Ö—ñ–¥ –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–µ–±—Ö—É–∫—ñ–≤ (Webhooks) –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ —á–∏—Å—Ç–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏, –∑–∞—Ö–∏—Å—Ç–æ–º –¥–∞–Ω–∏—Ö —Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—î—é.

---

## üíº –î–ª—è –±—ñ–∑–Ω–µ—Å—É (Use Cases)

–¶–µ–π –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –º–∞–ª–æ–≥–æ –±—ñ–∑–Ω–µ—Å—É —Ç–∞ —Å—Ç–∞—Ä—Ç–∞–ø—ñ–≤, —è–∫–∏–º –ø–æ—Ç—Ä—ñ–±–Ω–∞ **–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ CRM-—Å–∏—Å—Ç–µ–º–∞** –∞–±–æ –∑—Ä—É—á–Ω–∏–π –ª–æ–≥ –ø–æ–¥—ñ–π.

üîπ **–°—Ü–µ–Ω–∞—Ä—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
* **–ó–±—ñ—Ä –ª—ñ–¥—ñ–≤:** –ö–ª—ñ—î–Ω—Ç –ø–∏—à–µ –≤ –±–æ—Ç -> –ú–µ–Ω–µ–¥–∂–µ—Ä –±–∞—á–∏—Ç—å –∑–∞—è–≤–∫—É –≤ —Ç–∞–±–ª–∏—Ü—ñ.
* **–¢–µ—Ö–ø—ñ–¥—Ç—Ä–∏–º–∫–∞:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å –∑–∞–ø–∏—Ç–∏ -> –ö–æ–º–∞–Ω–¥–∞ –≤–µ–¥–µ –æ–±–ª—ñ–∫ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤.
* **–û–ø–∏—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Ñ–æ—Ä–º–∏:** –ó–±—ñ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π —É —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ.
* **–õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π:** –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —É —á–∞—Ç–∞—Ö.

üîπ **–ü–µ—Ä–µ–≤–∞–≥–∏:**
* üöÄ **–ú–∏—Ç—Ç—î–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è:** –î–∞–Ω—ñ –∑'—è–≤–ª—è—é—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü—ñ –∑–∞ —Å–µ–∫—É–Ω–¥–∏.
* üõ°Ô∏è **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å:** –Ø–∫—â–æ Google –¢–∞–±–ª–∏—Ü—ñ —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ, –¥–∞–Ω—ñ –Ω–µ –≤—Ç—Ä–∞—á–∞—é—Ç—å—Å—è (–ª–æ–≥ —É –ª–æ–∫–∞–ª—å–Ω—ñ–π –±–∞–∑—ñ –¥–∞–Ω–∏—Ö).
* üîí **–ë–µ–∑–ø–µ–∫–∞:** –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ —Å–ø–∞–º—É —Ç–∞ –ø—ñ–¥—Ä–æ–±–∫–∏ –∑–∞–ø–∏—Ç—ñ–≤.

## üíé –ß–æ–º—É —Ü–µ —Ä—ñ—à–µ–Ω–Ω—è –Ω–∞–¥—ñ–π–Ω—ñ—à–µ –∑–∞ –∑–≤–∏—á–∞–π–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏?

–ë—ñ–ª—å—à—ñ—Å—Ç—å –ø—Ä–æ—Å—Ç–∏—Ö –±–æ—Ç—ñ–≤ –º–∞—é—Ç—å –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏, —è–∫—ñ —Ü–µ–π –ø—Ä–æ—î–∫—Ç –≤–∏—Ä—ñ—à—É—î –Ω–∞ —Ä—ñ–≤–Ω—ñ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏:

| –ü—Ä–æ–±–ª–µ–º–∞ "–¥–µ—à–µ–≤–∏—Ö" –±–æ—Ç—ñ–≤ | –Ø–∫ —Ü–µ –≤–∏—Ä—ñ—à–µ–Ω–æ —Ç—É—Ç | –î–µ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è –≤ –∫–æ–¥—ñ |
| :--- | :--- | :--- |
| **–ó–∞–¥–≤–æ—î–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å**<br>*(–∫–æ–ª–∏ Telegram –ø–æ–≤—Ç–æ—Ä—é—î –∑–∞–ø–∏—Ç –ø—Ä–∏ –ø–æ–≥–∞–Ω–æ–º—É –∑–≤'—è–∑–∫—É)* | **Idempotency Check:** –ë–æ—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î ID –∫–æ–∂–Ω–æ–≥–æ –∞–ø–¥–µ–π—Ç—É. –î—É–±–ª—å–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏ —ñ–≥–Ω–æ—Ä—É—é—Ç—å—Å—è —ñ –Ω–µ –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å —É —Ç–∞–±–ª–∏—Ü—é. | `WebhookController.php` |
| **–ó–ª–∞–º —Ç–∞–±–ª–∏—Ü—ñ —Ñ–æ—Ä–º—É–ª–∞–º–∏**<br>*(—Ö–∞–∫–µ—Ä–∏ –º–æ–∂—É—Ç—å –≤–∏–¥–∞–ª–∏—Ç–∏ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ –ø–æ–ª–µ –≤–≤–µ–¥–µ–Ω–Ω—è)* | **Formula Injection Protection:** –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ —Å–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –µ–∫—Ä–∞–Ω—É—î —Å–∏–º–≤–æ–ª–∏ `=`, `+`, `-`, `@`. –í–∞—à—ñ –¥–∞–Ω—ñ –≤ –±–µ–∑–ø–µ—Ü—ñ. | `GoogleSheetsService.php` |
| **–§–µ–π–∫–æ–≤—ñ –∑–∞–ø–∏—Ç–∏**<br>*(—Å–ø–∞–º –∞–±–æ –∞—Ç–∞–∫–∞ –Ω–∞ –≤–µ–±—Ö—É–∫)* | **Secret Token Validation:** –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-Telegram-Bot-Api-Secret-Token` —á–µ—Ä–µ–∑ `hash_equals` –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –∑–∞–ø–∏—Ç –ø—Ä–∏–π—à–æ–≤ —Å–∞–º–µ –≤—ñ–¥ Telegram. | `WebhookController.php` |

---

## üõ† –¢–µ—Ö–Ω—ñ—á–Ω—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ (Tech Stack & Architecture)

–ü—Ä–æ—î–∫—Ç —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–æ –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ —Ä–æ–∑—à–∏—Ä—é–≤–∞–Ω—ñ—Å—Ç—å —Ç–∞ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å.

* **–ú–æ–≤–∞:** PHP 8.2
* **–§—Ä–µ–π–º–≤–æ—Ä–∫:** [Leaf PHP v4](https://leafphp.dev/) (–ª–µ–≥–∫–æ–≤–∞–∂–Ω–∏–π —Ç–∞ —à–≤–∏–¥–∫–∏–π).
* **–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö:** SQLite (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è) + **Phinx** –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ–π.
* **–õ–æ–≥—É–≤–∞–Ω–Ω—è:** Leaf Logger (–∑–∞–ø–∏—Å —É `logs/app.log`).
* **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó:** Telegram Bot API, Google Sheets API v4.
* **–°–µ—Ä–µ–¥–æ–≤–∏—â–µ:** Docker & Docker Compose.

### üß† –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è:
1.  **Dependency Injection:** –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä (`WebhookController`) —Ç–∞ —Å–µ—Ä–≤—ñ—Å–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ DI container.
2.  **Database Migrations:** –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∫–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ Phinx, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ª–µ–≥–∫–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç.
3.  **Graceful Error Handling:** –ì–ª–æ–±–∞–ª—å–Ω–∏–π –ø–µ—Ä–µ—Ö–æ–ø–ª—é–≤–∞—á –ø–æ–º–∏–ª–æ–∫ –∑–∞–ø–∏—Å—É—î –∫—Ä–∏—Ç–∏—á–Ω—ñ –∑–±–æ—ó –≤ –ª–æ–≥, –Ω–µ –∑—É–ø–∏–Ω—è—é—á–∏ —Ä–æ–±–æ—Ç—É –≤—Å—å–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
4.  **Security Layer:** –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ Telegram (`TG_WEBHOOK_SECRET`).

---

## üöÄ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫

–ü—Ä–æ—î–∫—Ç –ø–æ–≤–Ω—ñ—Å—Ç—é –¥–æ–∫–µ—Ä–∏–∑–æ–≤–∞–Ω–∏–π. –î–ª—è –∑–∞–ø—É—Å–∫—É –≤–∞–º –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è [Docker](https://www.docker.com/) —Ç–∞ [Git](https://git-scm.com/).

### 1. –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
```bash
git clone [https://github.com/your-username/tg-sheets-integration.git](https://github.com/your-username/tg-sheets-integration.git)
cd tg-sheets-integration

```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ—Ç–æ—á–µ–Ω–Ω—è

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø—Ä–∏–∫–ª–∞–¥–∞:

```bash
cp .env.example .env

```

–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ `.env`, –≤–∫–∞–∑–∞–≤—à–∏ –≤–∞—à—ñ –¥–∞–Ω—ñ (Token –±–æ—Ç–∞, ID —Ç–∞–±–ª–∏—Ü—ñ, —à–ª—è—Ö–∏):

```ini
# App
APP_NAME=LeadCatcherBot
APP_DEBUG=true
APP_TIMEZONE=Europe/Kyiv

# Telegram
TG_BOT_TOKEN=your_bot_token_here
TG_WEBHOOK_SECRET="your_very_complex_random_string_here"

# Google Sheets
GOOGLE_CREDENTIALS_FILE=credentials.json
GOOGLE_SHEET_ID=your_spreadsheet_id_here
GOOGLE_SHEET_RANGE='Sheet1!A:C'

# Database
DB_FILENAME=db/database.sqlite

```

> 
> **–í–∞–∂–ª–∏–≤–æ:** –§–∞–π–ª `credentials.json` (–∫–ª—é—á —Å–µ—Ä–≤—ñ—Å–Ω–æ–≥–æ –∞–∫–∞—É–Ω—Ç–∞ Google) –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ø–æ–∫–ª–∞—Å—Ç–∏ –≤ –∫–æ—Ä–µ–Ω–µ–≤—É –ø–∞–ø–∫—É –ø—Ä–æ—î–∫—Ç—É.
> 

### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

```bash
docker-compose up -d --build

```

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ —Å–µ—Ä–≤—ñ—Å –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é `http://localhost:8080`.

### 4. –ú—ñ–≥—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

–ü—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ –∑–∞–ø—É—Å–∫—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—å —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö (SQLite):

```bash
# –í–∏–∫–æ–Ω–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose exec app vendor/bin/phinx migrate

```

–¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å —Ñ–∞–π–ª –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —É –ø–∞–ø—Ü—ñ `db/` —Ç–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ.

### 5. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Webhook

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ **ngrok**:

```bash
ngrok http 8080

```

–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –≤–µ–±—Ö—É–∫ –¥–ª—è –±–æ—Ç–∞ (–∑–∞–º—ñ–Ω—ñ—Ç—å –∑–º—ñ–Ω–Ω—ñ –Ω–∞ –≤–∞—à—ñ –¥–∞–Ω—ñ):

```bash
curl -F "url=[https://your-ngrok-url.app/webhook](https://your-ngrok-url.app/webhook)" \
     -F "secret_token=your_very_complex_random_string_here" \
     [https://api.telegram.org/bot](https://api.telegram.org/bot)<YOUR_BOT_TOKEN>/setWebhook

```

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```text
src/
‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îî‚îÄ‚îÄ WebhookController.php  # –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –æ–±—Ä–æ–±–∫–∏ –∑–∞–ø–∏—Ç—É
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ GoogleSheetsService.php # –û–±–≥–æ—Ä—Ç–∫–∞ –Ω–∞–¥ Google API
‚îÇ   ‚îî‚îÄ‚îÄ TelegramService.php     # –†–æ–±–æ—Ç–∞ –∑ Telegram API
db/
‚îú‚îÄ‚îÄ migrations/                 # –ú—ñ–≥—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (Phinx)
‚îú‚îÄ‚îÄ seeds/                      # –°—ñ–¥–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
‚îî‚îÄ‚îÄ bootstrap.php               # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î
logs/                           # –õ–æ–≥–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É
phinx.php                       # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –º—ñ–≥—Ä–∞—Ü—ñ–π
index.php                       # –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É

```

---

## ü§ù –ö–æ–Ω—Ç–∞–∫—Ç–∏

–Ø–∫—â–æ –≤–∞—Å –∑–∞—Ü—ñ–∫–∞–≤–∏–≤ —Ü–µ–π –ø—Ä–æ—î–∫—Ç –∞–±–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –∑–∞–º–æ–≤–∏—Ç–∏ –ø–æ–¥—ñ–±–Ω—É —Ä–æ–∑—Ä–æ–±–∫—É:

* **Email:** vladimirovichser@gmail.com
* **Telegram:** @S_visp

---

*Developed with ‚ù§Ô∏è using Leaf PHP.*
